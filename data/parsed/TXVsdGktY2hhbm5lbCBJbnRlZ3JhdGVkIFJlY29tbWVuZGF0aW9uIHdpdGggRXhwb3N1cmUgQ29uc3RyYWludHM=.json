{"Multi-channel Integrated Recommendation with Exposure Constraints": "Yue Xu yuexu.xy@foxmail.com Alibaba Group. Qijie Shen qijie.sqj@alibabainc.com Alibaba Group. Jianwen Yin yjw264077@alibabainc.com Alibaba Group. Zengde Deng dengzengde@gmail.com Cainiao Network. Dimin Wang dimin.wdm@alibabainc.com Alibaba Group. Hao Chen chenhao@gmail.com The Hong Kong Polytechnic University. Lixiang Lai lixiang.llx@alibabainc.com Alibaba Group. Tao Zhuang zhuangtao.zt@alibabainc.com Alibaba Group.", "ABSTRACT": "Integrated recommendation, which aims at jointly recommending heterogeneous items from different channels in a main feed, has been widely applied to various online platforms. Though attractive, integrated recommendation requires the ranking methods to migrate from conventional user-item models to the new user-channelitem paradigm in order to better capture users' preferences on both item and channel levels. Moreover, practical feed recommendation systems usually impose exposure constraints on different channels to ensure user experience. This leads to greater difficulty in the joint ranking of heterogeneous items. In this paper, we investigate the integrated recommendation task with exposure constraints in practical recommender systems. Our contribution is forth-fold. First, we formulate this task as a binary online linear programming problem and propose a two-layer framework named Multi-channel Integrated Recommendation with Exposure Constraints (MIREC) to obtain the optimal solution. Second, we propose an efficient online allocation algorithm to determine the optimal exposure assignment of different channels from a global view of all user requests over the entire time horizon. We prove that this algorithm reaches the optimal point under a regret bound of O( \u221a \ud835\udc47 ) with linear complexity. Third, we propose a series of collaborative models to determine the optimal layout of heterogeneous items at each user request. The joint modeling of user interests, cross-channel correlation, and page context in our models aligns more with the browsing nature of feed products than existing models. Finally, we conduct extensive experiments on both offline datasets and online A/B tests to verify the effectiveness of MIREC. The proposed framework has now been implemented on the homepage of Taobao to serve the main traffic, providing service to hundreds of millions of users towards billions of items every day. Permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page. Copyrights for components of this work owned by others than ACM must be honored. Abstracting with credit is permitted. To copy otherwise, or republish, to post on servers or to redistribute to lists, requires prior specific permission and/or a fee. Request permissions from permissions@acm.org. KDD 2023, August 6, 2023, Long Beach, California, United States ACM ISBN 978-x-xxxx-xxxx-x/YY/MM...$15.00 https://doi.org/10.1145/nnnnnnn.nnnnnnn Junfeng Ge beili.gjf@alibabainc.com Alibaba Group. Live Streams Ads Pictures Videos Slide For More Page of Item Detail Click Ja 39,9", "KEYWORDS": "Integrated Recommendation, Feed Recommendation, Multi-channel, Exposure constraint, Context-Aware", "1 INTRODUCTION": "Nowadays, the ever-expanding new breeds of content, e.g., pictures, live streams, and short videos, drive the recommender system to drift from the traditional homogeneous form into an integrated form. Integrated recommender systems (IRSs) aim to simultaneously recommend heterogeneous items from multiple sources/channels in a row. This integrated form greatly expands users' choices on different types of content thereby satisfying users' diversified preferences on both item-level and channel-level. Therefore, IRS has nowadays been widely deployed in various online platforms such as the homepage feeds in Kuaishou [23], XiaohongShu [17], Taobao [29], and AliExpress [13]. In these products, users continuously slide down to browse and interact with heterogeneous items in a sequential manner, as shown in Figure 1. Though attractive, integrated feed recommendation faces more challenges than conventional recommendation with homogeneous items. First, real-world applications usually impose upper or lower exposure guarantees on different channels, such as lower constraints for sponsored/new content (e.g., ads and cold-start items) or upper constraints for individual channels to ensure diversity. These constraints lead to greater difficulty in the joint ranking of heterogeneous items. Second, heterogeneous items from multiple channels usually have different features and ranking strategies. Hence, it is difficult to directly compare items from different channels for joint ranking. Third, users' interests on different channels have a great impact on their behaviors, such that traditional user-item prediction models need to evolve into user-channel-item prediction models by considering both intra-channel and inter-channel information and their correlation with user interests. Finally, in feed products, users tend to review a large number of items in a row such that the previously viewed items have a great impact on the users' behavior towards the next item [17, 23, 29]. Therefore, it is of vital importance to consider the influence from page context when determining the item order in the return list. Although integrated feed recommendation has been widely deployed in practice, there are still few works focusing on the above challenges systematically. In this paper, we propose a general framework named Multi-channel Integrated Recommendation with Exposure Constraints (MIREC) to deal with the multi-channel integrated recommendation task under resource constraints in feed products. MIREC consists of two layers: an allocation-layer which optimizes the exposure of different channels from a global view over all user requests, and a ranking-layer which determines the optimal item layout of a given user request from a local view. These two layers operate in an iterative manner to make online decisions along with the arrival of user requests. The main contributions are as follows. \u00b7 This work formulates the integrated recommendation task with exposure constraints as a binary online linear programming problem and proposes a two-layer framework named MIREC to obtain the optimal solution. We also describe a practical system architecture for its implementation in industrial platforms. \u00b7 This work proposes an efficient multi-channel allocation algorithm to obtain the optimal exposure assignment of different channels over a fixed time horizon. The proposed algorithm is able to reach an optimal solution with linear complexity w.r.t. the number of constraints. We also prove that this algorithm admits a regret bound of O( \u221a \ud835\udc47 ) towards the global optimal point under certain assumptions. \u00b7 This work proposes a series of collaborative models to determine the optimal layout of heterogeneous items on a page, with joint modeling of user interests, cross-channel correlation, and page context. This aligns more with the browsing nature of feed products than existing models. \u00b7 This work conducts extensive experiments on both offline datasets and online A/B tests to verify the superiority of our proposed method. MIREC has been implemented on the homepage of Taobao to serve the main traffic. It brings 3% lift on user clicks, 1 . 56% lift on purchase, and 1 . 42% lift on stay time. It now serves hundreds of millions of users towards billions of items every day.", "2 RELATED WORK": "Re-ranking Methods. The main objective of re-ranking methods is to consider the mutual influence among a list of items in order to refine the prediction results produced by point-wise ranking models. Three prevalent models are commonly adopted in the existing literature: RNN-based methods, attention-based methods, and evaluator-generator-based methods. The first two methods feed an initial ranking list produced by point-wise models (e.g., Wide&Deep [10], DIN [39] and SIM [28]) into RNN-based (e.g., MiDNN [41], Seq2Slate [4] and DLCM [1]) or attention-based structure (e.g., PRM [27], PFRN [16], PEAR [20], and Raiss [22]) sequentially and output the encoded vector at each subsequent layer to model the mutual influences among items. The evaluator-generatorbased methods (e.g., SEG [32] and GRN [11]), use a generator to generate feasible permutations and use an evaluator to evaluate their list-wise utility to determine the optimal permutation. However, most re-ranking methods mainly focus on capturing the mutual influence among homogeneous items provided by one channel, instead of heterogeneous items provided by multiple channels. Moreover, they only optimize the item order at a single time slot, instead of considering a cumulative utility over a broad time horizon under resource constraints. Online Allocation Methods. The online allocation problem with resource constraints has been mostly studied in online convex optimization [15]. The primal-dual methods [3, 9, 25, 34, 35] avoid taking expensive projection iterations by penalizing the violation of constraints through duality. The BwK methods [2, 18] determines an optimal action from a finite set of possible actions and then optimize the policy of decision-making according to the observed rewards and costs over a fixed period of time. Several recent works studied the practical performance of online allocation in advertising recommendations. For example, PDOA [40] adopts the primal-dual framework by optimizing the dual prices with online gradient descent to eliminate the online max-min problem's regret. However, it assumes that the utility and cost values can be optimally estimated and only verify the performance through offline simulations. MSBCB [14] and HCA2E [6] proposed a two-level optimization framework based on BwK methods, where the high-level determines whether to present ads on the given request while the low-level searches the optimal position to insert ads. Most related works on online convex optimization focus on theoretical analysis (e.g., regret bound) instead of real-world applications. Other related works on advertising mainly consider binary content, i.e., ads or non-ads, instead of heterogeneous content. Directly extending them to deal with multi-channel recommendations in IRSs may lead to sub-optimal results. Integrated Recommendation. The integrated recommendation is a newly emerged but rapidly developing domain driven by practical problems [24]. Integrated recommendation methods need to consider both intra-channel and inter-channel features within the heterogeneous content and provide recommendation results continuously along with user arrivals. Recently, DHANR [13] proposed a hierarchical self-attention structure to consider the cross-channel interactions. HRL-Rec [33] decomposed the integrated re-ranking problem into two subtasks: source selection and item ranking, and use hierarchical reinforcement learning to solve the problem. DEAR [37] proposed to interpolate ads and organic items by deep Q-networks. Cross-DQN [21] also adopt a reinforcement learning solution with a cross-channel attention unit. However, many integrated methods only focus on ranking at a single time slot instead of over a continuous time horizon. The joint consideration of both integrated ranking and online allocation of limited resources still remains to be explored.", "3 PROBLEM FORMULATION": "This section formulates the integrated recommendation task with exposure constraints as a binary online linear programming problem. Specifically, we consider a generic IRS setting where user requests arrive sequentially during a finite time horizon. For each request, the IRS needs to rank a list of heterogeneous items provided by multiple channels. The aim is to maximize the overall utilities (e.g., the sum of clicks and pays) of all channels over the entire time horizon , subject to multiple resource constraints. Formally, the request of user \ud835\udc62 triggered at time \ud835\udc61 is described as \ud835\udc52 \ud835\udc61 = ( \ud835\udc62, \ud835\udc53 , \ud835\udc54, X \ud835\udc61 ) , where \ud835\udc53 \u2208 R + is a non-negative utility function , \ud835\udc54 \u2208 R + is a non-negative resource consumption function , and X \ud835\udc61 \u2282 R \ud835\udc51 + is a compact set denoting all possible item layouts for decisionmaking. For each request \ud835\udc52 \ud835\udc61 , the IRS needs to choose a number of \ud835\udc41 heterogeneous items from a candidate set \ud835\udc3c \ud835\udc61 and place them into \ud835\udc41 slots to form a complete page and return it to the user. This action \ud835\udc99 \ud835\udc61 \u2208 X \ud835\udc61 can be represented as a decision matrix \ud835\udc99 \ud835\udc61 \u2208 [ 0 , 1 ] \ud835\udc41 \u00d7| \ud835\udc3c \ud835\udc61 | , where each entry \ud835\udc65 \ud835\udc61,\ud835\udc5b,\ud835\udc56 is indexed by a slot \ud835\udc5b and a card index \ud835\udc56 . Once the user finished viewing the current page, a new user request will be triggered to ask the platform to return to the next page. Therefore, this decision-making process will be performed repeatedly. Moreover, in real-world applications, the item layouts need to satisfy the following constraints: where the upper constraint restricts that each slot must be assigned to one item and the lower constraint restricts that each item can be assigned to at most one slot. After executing an action \ud835\udc99 \ud835\udc61 at request \ud835\udc52 \ud835\udc61 , the IRS consumes a resource cost \ud835\udc54 ( \ud835\udc99 \ud835\udc61 ) and obtains an utility \ud835\udc53 ( \ud835\udc99 \ud835\udc61 ) . In IRS, the utility function \ud835\udc53 ( \ud835\udc99 \ud835\udc61 ) is defined according to the concerned metrics. For example, it can be defined as a combination of stay time, adds to cart, and favorites to encourage user engagement, or defined as a combination of clicks and purchases to encourage user conversion. Onthe other hand, the consumption function \ud835\udc54 ( \ud835\udc99 \ud835\udc61 ) is defined based on the concerned resource constraints. For example, the platform may need to allocate a certain amount of exposure to new channels in order to support the growth of new content [12]. Meanwhile, a too large proportion of exposures on one specific channel will damage the recommendation diversity thereby harming user experience [6, 26]. In this case, the IRS needs to guarantee both a lower exposure limit and an upper exposure limit for the heterogeneous items from different channels. In this paper, we focus on the exposure constraints in practical systems which lead to the following optimization problem where \ud835\udc41 (S) denotes the total available exposures to allocate over the entire time horizon, \ud835\udc3a max \ud835\udc5a,\ud835\udc61\u210e and \ud835\udc3a min \ud835\udc5a,\ud835\udc61\u210e denote the proportion of upper exposure limits and lower exposure limits for each channel \ud835\udc5a \u2208 M , respectively, and \ud835\udc54 \ud835\udc5a ( \ud835\udc99 \ud835\udc61 ) denotes the consumed exposures of cards from channel \ud835\udc5a after executing \ud835\udc99 \ud835\udc61 at request \ud835\udc52 \ud835\udc61 . Although this paper mainly focuses on the exposure guarantee, the above formulation is generally applicable to other problems with different resource constraints, e.g., the number of coupons to allocate.", "4 METHODOLOGY": "", "4.1 Framework Overview": "Directly solving problem P 0 is challenging. On one hand, the estimation accuracy of utility \ud835\udc53 ( \ud835\udc99 \ud835\udc61 ) and consumption \ud835\udc54 ( \ud835\udc99 \ud835\udc61 ) suffer influence from multi-factors, including the user's personal interest, the page context, and the cross-correlation between different channels. On the other hand, the determination of each \ud835\udc99 \ud835\udc61 needs to consider the cumulative exposures over the entire time horizon due to the exposure guarantees. Therefore, the optimization of exposure allocation must be performed from a global view over the entire timeline instead of a single time slot. To this end, we propose the MIREC framework which solves P 0 through online primal-dual iterations. Specifically, MIREC consists of two layers, i.e., the allocation-layer and the ranking-layer, which correspond to the dual and primal problem of P 0 , respectively. The allocation-layer optimizes dual variables to control the cumulative exposure of different channels on all user requests from a global view to guarantee the exposure limits. Meanwhile, the rankinglayer optimizes the item layout under fixed dual variables given by the allocation-layer, with the aim to maximize the instant utility on a single user request from a local view. These two layers operate in an iterative manner along with the arrival of online user requests to determine the optimal item layout at user requests continuously. The general workflow of MIREC is shown in Figure. 2. For the allocation-layer, we propose a simple but efficient Mirrordescent based Multi-channel Exposure Allocation (ME2A) algorithm to adaptively balance the utility gain and the exposure cost of presenting heterogeneous items from different channels. The proposed M2EA algorithm has a closed form solution that can be computed in linear time and admits a regret bound of O( \u221a \ud835\udc47 ) towards the global optimal point under certain assumptions. For the ranking-layer, we propose a personalized cross-channel ranking (PCR) model and a context-aware reranking (CAR) model to jointly determine the optimal item layout on a given user request, with fixed dual parameters given by the allocation-layer. In particular, PCR gives point-wise estimation of the quality of candidate items by joint modeling the influence from user interests, intra-channel information, and inter-channel correlations. Afterward, CAR refines the point-wise estimation generated by PCR into context-aware estimation by making use of both the context information and the high-level knowledge extracted from PCR.", "4.2 Global: Online Exposure Allocation": "In this section, we introduce the primal-dual formulation of P 0 and propose the ME2A algorithm to obtain the optimal solution for online systems. The complete algorithm is presented in Algorithm 1. Streaming Data Center MHSA MHSA MHSA Linear Linear V K Linear Linear V K Linear Linear V K Linear Linear V K MLP & Softmax Concate & Flatten MLP & Sigmoid MHSA Target Item Channel-2 Candidate Seq ... Channel-N Candidate Seq User Behavior Seq User Profile Channel-1 Candidate Seq Concate & MLP Target Item Prev Context Cand Context PCR Embs PCR Scores (c) CAR Model Update Constraints Update Duals (b) PCR CAR CH-1 ... CH-N Upstream RSs Report Request Real-time Exposures Multi-Channel Candidate Items Final Item List Real-time Duals Point-wise Scores Context-aware Scores ... Channel Info Embedding Layer Concate&Linear Weighted Sum Inter-channel Encoding Layer Interest-Aware Evolution Layer Intra-channel Encoding Layer (b) PCR Model (a) MIREC Framework } ) | ( ) ( argmax{ t t t t t I x g x f x \uf02d\uf06d \uf03d Optimal Item Selection Scaled Dot-product MHSA Multi-head Self-attention Embedding Vector Weights Embedding Crossing Dot Product Concate Q Q Allocation-layer Ranking-layer User Device PCR Embs 4.2.1 Primal-dual Formulation. The Lagrangian dual function of problem P 0 can be written as This is the focus of the ranking-layer to be discussed layer. After the optimal item layout \ud835\udc99 \ud835\udc61 at user request \ud835\udc52 \ud835\udc61 is properly determined, the next step is to update the dual variable \ud835\udf41 \ud835\udc61 to adjust the exposure of different channels in future user requests. Specifically, the remained exposure resource of different channels after the presentation of \ud835\udc99 \ud835\udc61 at \ud835\udc52 \ud835\udc61 is updated by Here \ud835\udf41 \u2265 0 and \ud835\udf40 \u2265 0 are the introduced dual parameters, \ud835\udc3a max \ud835\udc5a and \ud835\udc3a min \ud835\udc5a are short for \ud835\udc3a max \ud835\udc5a,\ud835\udc61\u210e \ud835\udc41 (S) and \ud835\udc3a min \ud835\udc5a,\ud835\udc61\u210e \ud835\udc41 (S) , respectively. Note that the parameters \ud835\udf41 and \ud835\udf40 are related to the violation of exposure consumption over the upper bound limit and the lower bound limit, respectively, which are mutually exclusive. In particular, if one of them is positive, the other one must be zero; otherwise, both of them are zero. Hence, it is viable to only introduce one real number dual variable \ud835\udf41 \u2208 R 1 \u00d7 \ud835\udc40 to replace \ud835\udf41 and \ud835\udf40 in the dual problem, which simplifies (5) into where [ \ud835\udf07 \ud835\udc5a ] + = max { \ud835\udf07 \ud835\udc5a , 0 } . 4.2.2 Dual Optimization for Exposure Constraints. The dual problem in (6) can be solved optimally via primal-dual updates. Specifically, given a user request \ud835\udc52 \ud835\udc61 = ( \ud835\udc62, \ud835\udc53 , \ud835\udc4f, X \ud835\udc61 ) , we assume that the utility \ud835\udc53 ( \ud835\udc99 \ud835\udc61 ) and cost \ud835\udf41 \ud835\udc47 \ud835\udc61 \ud835\udc54 ( \ud835\udc99 \ud835\udc61 ) under different item layout \ud835\udc99 \ud835\udc61 can be properly estimated by the models at the ranking layer. As such, the optimal item layout \ud835\udc99 \ud835\udc61 under a fixed dual variable \ud835\udf41 \ud835\udc61 can be obtained by solving the following primal problem: The sub-gradient of the dual function in (6) can be obtained via Danskin's theorem [5] by \u2207 \ud835\udf07 \ud835\udc5a,\ud835\udc61 = -\ud835\udc54 \ud835\udc5a ( \ud835\udc99 \ud835\udc61 ) + \ud835\udc3a max \ud835\udc5a,\ud835\udc61 + 1 \u00b7 \u2736 ( \ud835\udf07 \ud835\udc5a,\ud835\udc61 \u2265 0 ) + \ud835\udc3a min \ud835\udc5a \u00b7 \u2736 ( \ud835\udf07 \ud835\udc5a,\ud835\udc61 \u2264 0 ) , (9) where \u2736 ( \ud835\udc65 \u2208 \ud835\udc34 ) is an indicator function which equals to one if \ud835\udc65 \u2208 \ud835\udc34 otherwise zero. As such, the dual variable \ud835\udf41 \ud835\udc61 can be updated based on the mirror-descent method as where \ud835\udc49 \u210e ( \ud835\udc65,\ud835\udc66 ) = \u210e ( \ud835\udc65 ) \u210e ( \ud835\udc66 )\u2207 \u210e ( \ud835\udc66 ) \ud835\udc47 ( \ud835\udc65 -\ud835\udc66 ) is the Bregman divergence based on reference function \u210e (\u00b7) and \ud835\udf02 \u2208 R is a fixed step-size. Note that this mirror descent step can be computed in linear time since (10) admits a closed-form solution. For example, if we use \u210e ( \ud835\udf41 ) = 1 2 \u2225 \ud835\udf41 \u2225 2 as the reference function, the dual update in (10) becomes which recovers the online projected gradient descent method. Moreover, in order to guarantee the upper exposure constraints, one needs to examine the violation of upper limits of each channel before the determination of \ud835\udc99 \ud835\udc61 at each user request. If the sum of exposures of a specific channel exceeds its upper bound, one needs to remove all candidate items from this channel to forbid allocate more exposures when determining \ud835\udc99 \ud835\udc61 . We present the optimality of this proposed ME2A algorithm and its feasibility to guarantee exposure constraints of different channels as follows. Detailed proofs are deferred to the appendix. Algorithm 1 The proposed ME2A algorithm of MIREC 1: Initialization: 2: Initial dual solution \ud835\udf07 1 , total time periods \ud835\udc47 , reference function \u210e (\u00b7) and step-size \ud835\udf02 . 3: Iteration: 4: for \ud835\udc61 = 1 , 2 , \u00b7 \u00b7 \u00b7 , \ud835\udc47 do 5: Receive request \ud835\udc52 \ud835\udc61 = ( \ud835\udc62, \ud835\udc53 , \ud835\udc4f, X \ud835\udc61 ) . 6: Update the candidate set \ud835\udc3c \ud835\udc61 provided by multi-channels. 7: Determine the optimal item list \ud835\udc99 \ud835\udc61 by solving the primal problem in (7) at the ranking-layer. 8: Update the remained exposure resource via (8). 9: Obtain the sub-gradient of the dual variable via (9). 10: Update the dual variable based on mirror descent via (11). 11: end for 4.2.3 Optimality. It is viable to prove that Algorithm 1 is asymptotically optimal and admits a regret bound scales as O( \u221a \ud835\udc47 ) when the user requests arrive from an i.i.d unknown distribution. This assumption is reasonable when the number of requests is numerous [3, 25, 40]. Specifically, we denote Algorithm 1 as \ud835\udf0b and the overall utility over all user requests in set S under the running of \ud835\udf0b as \ud835\udc45 ( \ud835\udf0b |S) = \u02dd \ud835\udc47 \ud835\udc61 = 1 \ud835\udc53 ( \ud835\udc99 \ud835\udc61 ) . The regret of model \ud835\udf0b is defined as the worst-case difference over S between the expected performance of the global optimal solution and the model \ud835\udf0b : where OPT (S) denotes the optimal utilities one can obtain under the request set S . The regret bound can be given as follows. Theorem 1. Suppose that the requests come from an i.i.d model with unknown distribution. Then, Regret ( \ud835\udf0b |S) \u2264 \ud835\udc36 1 + \ud835\udc36 2 \ud835\udf02\ud835\udc47 + \ud835\udc36 3 \ud835\udf02 with \ud835\udf02 > 0 holds for any \ud835\udc47 \u2265 1 . Here \ud835\udc36 1 , \ud835\udc36 2 and \ud835\udc36 3 are constant values depending on the numerical bounds of the utility \ud835\udc53 , the consumption \ud835\udc54 , and terms from the dual iterates in Eq. (10). From Theorem 1, we obtain Regret ( \ud835\udf0b |S) \u2264 \ud835\udc42 ( \u221a \ud835\udc47 ) when using a step-size \ud835\udf02 \u221d \ud835\udc50 / \u221a \ud835\udc47 with any constant \ud835\udc50 > 0. We defer the proof and detailed definitions of \ud835\udc36 1 , \ud835\udc36 2 , and \ud835\udc36 3 into the appendix. 4.2.4 Exposure Feasibility. In Algorithm 1, if the upper exposure limit of a specific channel is violated, we will forbid the exposure of any item from this channel when determining the item list \ud835\udc99 \ud835\udc61 . Therefore, the exposure can never be overspent. On the other hand, the lower exposure limits are soft-restricted by adaptively adjusting the dual variable \ud835\udf41 . This may cause exposure underspent. However, it is viable to prove that the violation of the lower exposure limit of any channel also admits a convergence rate of \ud835\udc42 ( \u221a \ud835\udc47 ) . In other words, even if the violations on lower exposure limits may occur, their growth is considerably smaller than \ud835\udc47 . Proposition 1. Suppose the requests come from an i.i.d model with unknown distribution. Then, it holds for any \ud835\udc47 \u2265 1 and any channel \ud835\udc5a \u2208 M that \ud835\udc3a min \ud835\udc5a -E h \u02dd \ud835\udc47 \ud835\udc61 = 1 \ud835\udc54 \ud835\udc5a ( \ud835\udc99 \ud835\udc61 ) i \u2264 \ud835\udc36 4 + \ud835\udc36 5 \ud835\udf02 , where \ud835\udc36 4 and \ud835\udc36 5 are constant values depends on the numerical bounds of utility \ud835\udc53 , consumption \ud835\udc54 , and terms from the dual iterates (10) . Proposition 1 states that when using \ud835\udf02 \u221d \ud835\udc50 / \u221a \ud835\udc47 with \ud835\udc50 > 0, the exposure underspend of any channel is bounded by \ud835\udc42 ( \u221a \ud835\udc47 ) . We defer the proof and definitions of \ud835\udc36 4 and \ud835\udc36 5 into the appendix.", "4.3 Local: Context-Aware Integrated Ranking": "Different from the allocation-layer which optimizes an objective with accumulative utilities over the entire time horizon as defined in (6), the ranking-layer focus on maximizing the utilities on a single time slot. This corresponds to the primal problem given in (7): In other words, the allocation layer adjusts the exposure of items from different channels by optimizing the dual parameter \ud835\udf41 \ud835\udc61 from a global view of all user requests. While the ranking-layer determines the optimal item list \ud835\udc99 \ud835\udc61 under a fixed dual variable \ud835\udf41 \ud835\udc61 from a local view of a given user request \ud835\udc52 \ud835\udc61 . There are two common characteristics that are strongly related to the estimation of \ud835\udc53 ( \ud835\udc99 \ud835\udc61 ) and \ud835\udc54 ( \ud835\udc99 \ud835\udc61 ) in the integrated recommendation. First, users' preference on different channels has a great impact on the utility (e.g., prefer to click or not) and exposure (e.g., prefer to view or not) estimations. Therefore, it is of vital importance to consider both intra-channel and inter-channel correlations with reference to user interests during the estimation. Second, in feed products, users tend to review a large number of items in a row such that the previously viewed items have a great impact on users' behavior towards the next item. Therefore, it is necessary to consider page context when determining the item order. Therefore, we propose two models to deal with the above two challenges, respectively. First, we propose PCR model to deal with the joint modeling of user interests and inter/intra-channel correlation. It gives a point-wise estimation of the utility/exposure value of presenting each candidate item. Second, we propose CAR model to refine the point-wise estimation from PCR into contextaware estimation by considering both context information and the high-level knowledge obtained from PCR. It is also responsible for selecting optimal items from a set of candidate items to generate the final return list. In real-world systems, for each user request, we only need to run PCR once to get the point-wise scores, and then run CAR multiple times to generate the return list. Next, we mainly focus on the estimation of \ud835\udc53 ( \ud835\udc65 ) , the estimation of \ud835\udc54 ( \ud835\udc65 ) can be performed in a similar way by changing the learning goals. 4.3.1 Personalized Cross-Channel Ranking Model. PCR takes four types of features as input, i.e., the user profile feature \ud835\udc4b \ud835\udc62 , the user behavior sequences \ud835\udc4b \ud835\udc4f , the candidate items provided by each channel \ud835\udc4b \ud835\udc59 , and the item-level features of target item \ud835\udc4b \ud835\udc56 . As shown in Figure 2, We use an embedding layer to transform these features into dense embedding vectors, denoted as \ud835\udc38 \ud835\udc62 , \ud835\udc38 \ud835\udc4f , \ud835\udc38 \ud835\udc59 and \ud835\udc38 \ud835\udc56 , respectively. These embedding vectors are then fed into three components, i.e., the intra-channel encoding layer, interest-aware evolution layer, and inter-channel encoding layer in order, which are described below. Intra-Channel Encoding layer. This layer aims at extracting the mutual influence of item pairs and other extra information within the channel. We adopt the well-known multi-head attention [31] as the basic learning unit for intra-channel encoding. This is due to that the self-attention mechanism is able to directly capture the mutual influences between any two items, and is robust to far distance within the sequence. Formally, the formulation of this attention-based encoding can be written as where \ud835\udc4a \ud835\udc42 \u2208 R \ud835\udc51 \u210e \u00d7 \ud835\udc51 \u210e denotes the learnable parameters for each head with \ud835\udc51 \u210e being the length of projected embedding vector after attention, \ud835\udc4a \ud835\udc44 , \ud835\udc4a \ud835\udc3e , \ud835\udc4a \ud835\udc49 \u2208 R \ud835\udc51 \u00d7 \ud835\udc51 \u210e / \u210e are the vectors of query, key and value with \ud835\udc51 being the length of original embedding vector and \u210e being the number of heads, \ud835\udc49 \ud835\udc5a \ud835\udc59 represents the encoded candidate items of each channel \ud835\udc5a \u2208 M . Interest-Aware Evolution Layer. Existing works such as PRM [27] and DHANR [13] directly apply the self-attention mechanism to model the inter-dependencies among items and channels without considering user's recent behavior. However, the interests hidden in user's behavior items usually have a great impact on the prediction accuracy in recommendation tasks [7, 28, 38, 39]. The recently proposed PEAR [20] firstly models the dependency between the candidate item list and the user's historical behaviors based on a transformer-like structure, which, however, suffers from two limitations. First, directly mixing the raw item-level features from user behavior items may introduce redundant or noisy information to degrade the learning performance. Second, each user may exhibit multiple interest points, such that it is beneficial to reinforce the interest related to the target item before feature-crossing to avoid drifting. Therefore, we first reinforce the interest vector according to the correlation between behavior items and the target item as where \ud835\udc35 is the length of behavior sequence, \ud835\udc4f \ud835\udc56 is the behavior item, \ud835\udc49 \ud835\udc48 denotes the user representation feature with respect to \ud835\udc38 \ud835\udc56 , and \ud835\udc34 (\u00b7) is a feed-forward network whose output is the activation weight \ud835\udc64 \ud835\udc56 . Then, we make use of this reinforced interest vector to extract useful information from the candidate items of different channels. Formally, for each channel \ud835\udc5a , given \ud835\udc49 \ud835\udc5a \ud835\udc59 and \ud835\udc49 \ud835\udc48 as inputs, we use scaled dot-product attention formulated as follows: where \ud835\udc4a \ud835\udc58 1 , \ud835\udc4a \ud835\udc63 1 \u2208 R \ud835\udc51 \u00d7 \ud835\udc51 \u210e and \ud835\udc4a \ud835\udc58 2 , \ud835\udc4a \ud835\udc5e , \ud835\udc4a \ud835\udc63 2 \u2208 R \ud835\udc51 \u210e \u00d7 \ud835\udc51 \u210e are all learnable parameters, [\u00b7] denotes the concatenation operation. After the above operations, we successfully merged the information from the candidate item lists and the user's historical behaviors into a series of evolved embedding vectors for further processing. Inter-Channel Encoding Layer. Previous layers mainly extract intra-channel correlations. We now focus on the modeling of interchannel correlation. First, we feed the embedding vector of each channel and the target item embedding into the MLP layer with softmax function to obtain the importance weights on each channel that is related to the target item: where \ud835\udc4a \ud835\udc36\ud835\udc3b \u2208 R 1 \u00d7 \ud835\udc5a is the importance weights, and \ud835\udc3b \ud835\udc60 \ud835\udc5a denotes the concatenation of all channels' output from the Interest-Aware Evolution Layer. Second, we perform multi-head self-attention on the evolved embedding vector \ud835\udc3b \ud835\udc60 \ud835\udc5a of each channel \ud835\udc5a \u2208 M to obtain the mixed embedding \u02dc \ud835\udc3b \ud835\udc60 \ud835\udc5a which contains rich inter-channel information. Then, we perform the weighted sum on the mixed embedding of all channels based on \ud835\udc4a \ud835\udc36\ud835\udc3b to get the final representation of multi-channel modeling: where [ \u02dc \ud835\udc3b \ud835\udc60 \ud835\udc5a ] represents the concatenation of the mixed embeddings of all channels. Finally, we concatenate all vectors as input and feed it into the MLP layers with a sigmoid function to predict the utility of presenting a given target item to a given target user as 4.3.2 Context-Aware Refinement Model. In this section, we propose the CAR model to refine the point-wise utility scores estimated by PCR into context-aware utility scores. Given a candidate item set \ud835\udc3c \ud835\udc50\ud835\udc4e\ud835\udc5b\ud835\udc51 with size \ud835\udc41 , the aim of CAR is to optimally choose \ud835\udc3e items from \ud835\udc3c \ud835\udc50\ud835\udc4e\ud835\udc5b\ud835\udc51 and allocate them to the \ud835\udc3e slots in a page based on the learning results from PCR. We maintain two types of context information in CAR, i.e., the context of previous items and the context of remaining candidate items. Specifically, when selecting the \ud835\udc58 -th item in a page, we represent the context of previously presented \ud835\udc58 -1 items \u210e \ud835\udc5d\ud835\udc5f\ud835\udc52 by mean-pooling over their embeddings. Meanwhile, we represent the context of all candidate items \u210e \ud835\udc50\ud835\udc4e\ud835\udc5b by mean-pooling over the embeddings of all remained candidates. These two context vectors are updated and repeated along with the item selection process. Furthermore, we perform a series of embedding crossing operations between the target item embedding \ud835\udc52 \ud835\udc56 and the context embeddings to model the influence from page context. In specific, the operations in the context of previous items can be formulated as follows: where \u2295 , \u2297 , and \u2296 denote the addition, subtraction, and dot product between embedding vectors, respectively. The same goes for \ud835\udc3b \ud835\udc50\ud835\udc61 by replacing \u210e \ud835\udc5d\ud835\udc5f\ud835\udc52 in (19) with the context of candidate items \u210e \ud835\udc50\ud835\udc4e\ud835\udc5b . Additionally, we also perform embedding-crossing between the context embeddings and the high-level knowledge \ud835\udc49 \ud835\udc3f from PCR to obtain another two vectors, i.e., \ud835\udc3b \ud835\udc63 \ud835\udc50\ud835\udc61 and \ud835\udc3b \ud835\udc63 \ud835\udc5d\ud835\udc5f\ud835\udc52 . Finally, for each candidate item \ud835\udc56 \u2208 \ud835\udc3c \ud835\udc50\ud835\udc4e\ud835\udc5b\ud835\udc51 , we predict the contextaware utility score by feeding these embedding vectors along with the point-wise utility score \ud835\udc4c \ud835\udc43\ud835\udc36\ud835\udc45 from PCR and user profile features \ud835\udc38 \ud835\udc62 into one MLP layer as where \ud835\udf0e represents the sigmoid activation function. After scoring all candidate items, we choose the item with the highest score as the optimal item for slot \ud835\udc58 , and update the context vectors and the remained candidate items accordingly. This process will be repeated \ud835\udc3e times to generate a return item list of length \ud835\udc3e . Note that the above operations in CAR only involve linear computations, such that this item selection process is cost-efficient in online systems. CAR PCR Data\u00a0Links User\u00a0Logs )} ( ) ( argmax{ t t t x g x f \uf02d\uf06d (a)\u00a0Integrated\u00a0Ranking Controller Final\u00a0Item\u00a0List Request Candidate\u00a0Items Channel-2 Channel-N Channel-1 Upstream\u00a0RS ... Record User\u00a0Device Context-Aware\u00a0Estimation Feature Center (b)\u00a0Exposure Controller MCA Real-time Exposures Real-time Features Data\u00a0Stream Center Duals Both PCR and CAR can be trained with the commonly used crossentropy loss as in other ranking models, the learning objective can be given as where D denotes the training dataset, \ud835\udc66 \ud835\udc52 \ud835\udc61 \ud835\udc62,\ud835\udc56 is the real user-item recommendation label (equals 1 or 0) between user \ud835\udc62 and item \ud835\udc56 at request \ud835\udc52 \ud835\udc61 , and \u02c6 \ud835\udc66 \ud835\udc52 \ud835\udc61 \ud835\udc62,\ud835\udc56 is the predicted label given by \ud835\udc4c \ud835\udc43\ud835\udc36\ud835\udc45 or \ud835\udc4c \ud835\udc36\ud835\udc34\ud835\udc45 . In our experiments, when predicting the utility function \ud835\udc53 with user clicks, \ud835\udc66 \ud835\udc52 \ud835\udc61 \ud835\udc62,\ud835\udc56 refers to the click label; when predicting the cost function \ud835\udc54 with exposure constraints, \ud835\udc66 \ud835\udc52 \ud835\udc61 \ud835\udc62,\ud835\udc56 refers to the exposure label between user \ud835\udc62 and item \ud835\udc56 at request \ud835\udc52 \ud835\udc61 , i.e., whether user \ud835\udc62 has seen item \ud835\udc56 at request \ud835\udc52 \ud835\udc61 . One can readily change the learning objective according to actual demands.", "4.4 Online Implementation": "In this section, we introduce the online implementation of our proposed MIREC model in the homepage feed of Taobao. The presented system architecture is able to handle 120 , 000 QPS at traffic peak and respond within 20 milliseconds in general. It now serves the main traffic of Taobao to provide services to hundreds of millions of users towards billions of items in Taobao every day. Figure. 3 gives a general architecture to implement our proposed MIREC model in real-world IRS. Each time a user request is triggered from the device, the upstream RS of each channel will run its own recommendation models to determine the top items to return. The Integrated Recommendation Controller uses the top items from all channels as the candidates. It retrieves user/item features from a feature center in real-time and ranks candidate items by solving based on our proposed LCPR and PCR model. Meanwhile, the dual variable \ud835\udf07 is estimated by an Exposure Controller. This module monitors the completeness of exposure guarantees based on the real-time exposures collected from user logs and updates the dual variable to adjust the exposures on different channels periodically.", "5 EXPERIMENTAL RESULTS": "This section conducts extensive experiments on both offline datasets and real-world applications with the goal of answering the following research questions: Q1: Does our proposed PCR and CAR outperform other baseline models in integrated ranking tasks? Q2: Does our proposed MIREC framework outperform other methods in integrated recommendation tasks with exposure constraints? Q3: How does MIREC perform in real-world applications?", "5.1 Experimental Setup": "5.1.1 Datasets. Weuse one public dataset named MicroVideo-1.7M and one industrial dataset named Taobao for experiments. The public available MicroVideo-1.7M dataset 1 released by [8] contains 12 , 737 , 619 interactions that 10 , 986 users have made on 1 , 704 , 880 micro-videos. This dataset provides rich user behavior data and timestamps to evaluate the performance on both interest modeling and context-aware reranking. The Taobao dataset is an industrial private dataset that contains users' behaviors and feedback logs from multiple channels in the homepage feed of Taobao Mobile App. It is one of the largest feed scenarios for online merchandise in China. The feed provides items in form of the streams, videos, pictures, etc, from various channels. Users can slide to view more items in a row. This dataset contains about ten billion interactions that one hundred million of users have made on sixty million items. Wealso conduct online A/B tests on the platform Taobao to examine the performance of MIREC in real-world applications. 5.1.2 Comparing Methods. We compare MIREC with two mainstreams of baselines. The first steam of baselines are the methods for ranking tasks with different goals on user interest modeling (i.e., DIN and DIEN), re-ranking (i.e., DLCM, PRM, and PEAR), or multichannel recommendation (i.e., STAR and DHANR). Specifically, DIN [39] is a widely used benchmark for sequential user data modeling in point-wise CTR predictions, which models short behavior sequences with target attention. DIEN [39] combines GRUs and attention to capture temporal interests from users' historical behaviors with respect to the target item. DLCM [1] uses gated recurrent units (GRU) to sequentially encode the top-ranked items with their feature vectors. PRM [27]: directly optimizes the whole recommendation list by employing a Transformer structure to efficiently encode the information of all items in the list. PEAR [20] not only captures feature-level and item-level interactions but also models item contexts from both the candidate list and the historical clicked item list. STAR [30] trains a unified model to serve all channels simultaneously, which consists of shared centered parameters and channel-specific parameters. DHANR [13] proposes a hierarchical self-attention structure to consider cross-channel interactions. The second stream of baselines is the online allocation methods which have been successfully applied in industrial applications for online resource allocation. Fixed is the fixed-positions strategy, where the positions of recommended items and ads are manually pre-determined for every request. \ud835\udefd -WPO : is based on the WholePage Optimization (WPO) [36]. WPO ranks recommended and ad candidates jointly according to the predefined ranking scores. Similar to [6], we introduce an adjustable variable \ud835\udefd to control the proportion of different channels on each request to satisfy the resource constraint. In general, \ud835\udefd -WPO can be regarded as a heuristic list merging algorithm. Each list from one channel is assigned a priority weight. The algorithm merges the top items of each list based on both their ranking scores and the priority weights into a final return list. HCA2E [6]: proposed a two-level optimization framework based on BwK methods. The high-level determines whether to present ads on the page while the low-level searches the optimal position to insert ads heuristically. 5.1.3 Metrics. For offline experiments, we use user clicks to measure the utility function \ud835\udc53 . For online experiments, we consider a joint measurement of user click, purchase, and stay-time for utility function \ud835\udc53 . For all experiments, we use the exposure of items to measure cost function \ud835\udc54 . In this case, we compare the performance of integrated ranking in offline evaluation using the widely used Area Under ROC (AUC) and normalized discounted cumulative gain (nDCG) [19]. Remark that nDCG@K refers to the performance of top-k recommended items in the return list. The online performance is evaluated by CLICK, Click-Through-Rate (CTR), Gross Merchandise Volume (GMV), and Stay Time. Here, CLICK refers to the total number of clicked items. CTR is defined as CLICK/PV with PV denoting the total number of impressed items. CTR measures users' willingness to click and is therefore a widely used metric in practical applications. GMV is a term used in online retailing to indicate a total sales monetary-value for merchandise sold over a certain period of time. Stay Time denotes the time period of users' average stay time in the product, averaged on all users. 5.1.4 Reproducibility. Our source codes have been made public to ensure reproducibility 2 . In all experiments, we use the validation set to tune the hyper-parameters to generate the best performance for different methods. The learning rate is searched from 10 -4 to 10 -2 . The L2 regularization term is searched from 10 -4 to 1. All models use Adam as the optimizer.", "5.2 Offline Evaluation": "5.2.1 Q1: Performance on Integrated Ranking. We first compare the performance with the first stream of baselines on item ranking. The results are shown in Table 1, which leads to the following findings. First, the re-ranking methods perform generally better than the point-wise user interest methods, indicating that modeling mutual influence among the input ranking list is of vital importance for the ranking. Therefore, it is essential to consider the influence from page context in feed recommendations. Second, the multi-channel methods perform better than the reranking methods, which verifies that exploiting the distinction and mutual influence among different channels has a great impact on integrated recommendations. Besides, we also notice that DHANR performs better than STAR, which may be due to that DHANR considers both the correlation among different channels and the influence from the candidate list. Finally, our proposed MIREC model achieves superior performance than other competitors on all datasets, verifying the effectiveness of joint modeling the cross-channel information, user interest, context information, and candidate list. 5.2.2 Ablation Study. Theresults in Table. 2 investigates the impact of each component of MIREC on item quality estimation. Specifically, PCR \u2217 replaces the attention mechanism for user behaviors in the Merged-Sequence Evolution layer with a self-attention mechanism which is in accordance with PEAR [20]. PCR outperforms PCR \u2217 indicates that the tailored attention mechanism in PCR can filter out noisy or redundant information from historical behaviors to benefit the subsequent modeling of bi-sequence interaction. PCR \u2020 removes the scaled dot-product attention mechanism (i.e. there is no explicit interaction between initial lists and user behaviors) and achieved a worse performance. This demonstrates the necessity of this direct modeling between sequences, directly guiding the reordering of the initial lists. PCR w/o IntraCE removes the IntraChannel Encoding module, i.e., directly feeding the embeddings of the initial item lists into subsequent layers for learning. The result shows that PCR achieves superior performance than PCR w/o IntraCE, verifying that it is of vital importance to model the mutual information inside each channel for final prediction. PCR w/o InterCE removes the Inter-Channel Encoding, which also leads to worse performance. It verifies that without considering the relationship and distinction between different channels will degrade the model performance considerably. Moreover, the joint learning of PCR and CAR performs better than only using PCR. This verifies that the modeling of page-wise context information can improve prediction accuracy effectively. 5.2.3 Q2: Performance with Exposure Constraints. To the best of our knowledge, there does not exist publicly available datasets which has rich user logs and multi-channel features to examine the joint performance of integrated recommendation and exposure allocation. Therefore, we only perform experiments on Taobao dataset, using the complete platform logs. In this experiment, we assume that the IRS needs to allocate exposures to satisfy the exposure guarantees of four distinct channels. The aim is to maximize the overall user-click utility of all channels. The compared fixed, WPO, and HCA2E methods all use point-wise scores to be consistent with their original proposals. For HCA2E, we use their proposed heuristic search method to determine the final order of the item list. The results are shown in Table 3, which are averaged on multiple runs to give a fair comparison. The simulated time horizon is one complete day with more than one billion user requests from real productive environment. We evaluate the performance using two different sets of lower bounds: 1) Channel 1=55%, Channel 2 = 20%, Channel 3 = 15%, Channel 4 = 10%; 2) Channel 1=70%, Channel 2 = 15%, Channel 3 = 10%, Channel 4 = 5%. The parameters of all comparing methods are carefully tuned to satisfy the exposure constraints. The completeness in Table 3 shows that all methods can control the violation of constraints to a low-level. HCA2E and our proposed MIREC perform slightly better than the fixed method and the WPO method. Noticeably, our proposed method outperforms other comparing methods considerably in terms of CTR enhancement, which verifies that the joint use of the allocation and estimation algorithm can bring a remarkable improvement in practical environments.", "5.3 Online Evaluation": "MIREC has been fully deployed in the homepage feed of Taobao named Guess-you-like to serve the main traffic. Guess-you-like is one of the largest merchandise feed recommendation platform in China, which serves more than hundreds of millions of users toward billions of items every day. We deploy MIREC at the integrated recommendation stage in Guess-you-like platform, which takes hundreds of candidate items provided by multiple channels as input and outputs the final item list to return to the user. The online performance is compared against our previous baseline which is similar as a combination of \ud835\udefd -WPO and HCA2E. In particular, the baseline uses a point-wise model for item quality estimation and uses a PID-based feedback control to automatically adjust parameter \ud835\udefd to guarantee the exposures for different channels. For each user \u0000 \u0000 \u0000 \u0000 \u0000 \u0000 \u0000 \u0000 \u0000 \u0000\u0000 \u0000\u0000 \u0000\u0000 \u0000\u0000 \u0000\u0000 \u0000\u0000\u0000 \u0000\u0000 \u0000 \u0000 \u0000 \u0000\u0000 \u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000 \u0000\u0000 \u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000 (b) Exposure distribution. \u0000\u0000 \u0000\u0000 \u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000 \u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000 \u0000 \u0000 \u0000 \u0000 \u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 \u0000\u0000\u0000\u0000 (c) CTR on different positions. request, the baseline also runs an MDP-based search method to determine the optimal card layout based on the estimated scores, which is similar as the heuristic search method in HCA2E. The overall performance in Table 4 is averaged over two consecutive weeks. The results show that compared with the baseline method, MIREC brings an improvement of 3 . 00% for CLICK, 1 . 75% for CTR, 1 . 56% for GMV, and 1 . 42% for stay time. Compared with the fixed method, MIREC brings an improvement of 3 . 00% for CLICK, 1 . 75% for CTR, 1 . 56% for GMV, and 1 . 42% for stay time. These improvements indicate that our framework is able to increase user's willingness to stay and interact with the recommended items in practical applications. It is noteworthy that 1% improvement on CLICK in Guess-you-like brings millions of clicks every day. Figure. 4 shows a detailed comparison of the exposure allocation results of a specific channel, where the items from this channel have a generally lower CTR than others. Each line in Figure. 4(a) represents the robustness of long-term exposure guarantee of this channel within two consecutive weeks. It is clear that compared with the baseline, our proposed MIREC is more robust to alleviate daily exposure fluctuations. The distribution of exposures on different positions in the feed is given in Figure. 4(b). The result shows that our proposed framework tends to put lower-quality items backward to increase the overall utilities of all channels. Consequently, as shown in Figure. 4(c), the averaged CTR of all channels on each position can be improved remarkably. This verifies that MIREC is superior in optimizing the item layout from a global perspective.", "6 CONCLUSION": "In this paper, we consider the integrated recommendation task with exposure constraints. In particular, we propose a two-layer framework named MIREC, where the allocation-layer optimizes the exposure of different channels, while the ranking-layer determines the optimal item layout on each page. Extensive experiments verified the effectiveness of our proposed framework. MIREC has been implemented on the homepage feed in Taobao to serve hundreds of millions of users towards billions of items every day.", "REFERENCES": "[1] Qingyao Ai, Keping Bi, Jiafeng Guo, and W Bruce Croft. Learning a deep listwise context model for ranking refinement. In The 41st international ACM SIGIR conference on research & development in information retrieval , pages 135-144, 2018. [2] Ashwinkumar Badanidiyuru, Robert Kleinberg, and Aleksandrs Slivkins. Bandits with knapsacks. Journal of the ACM (JACM) , 65(3):1-55, 2018. [3] Santiago R Balseiro, Haihao Lu, and Vahab Mirrokni. The best of many worlds: Dual mirror descent for online allocation problems. Operations Research , 2022. [4] Irwan Bello, Sayali Kulkarni, Sagar Jain, Craig Boutilier, Ed Chi, Elad Eban, Xiyang Luo, Alan Mackey, and Ofer Meshi. Seq2slate: Re-ranking and slate optimization with rnns. arXiv preprint arXiv:1810.02019 , 2018. [5] Dimitri P Bertsekas. Nonlinear programming. Journal of the Operational Research Society , 48(3):334-334, 1997. [6] Dagui Chen, Qi Yan, Chunjie Chen, Zhenzhe Zheng, Yangsu Liu, Zhenjia Ma, Chuan Yu, Jian Xu, and Bo Zheng. Hierarchically constrained adaptive ad exposure in feeds. arXiv preprint arXiv:2205.15759 , 2022. [7] Qiwei Chen, Yue Xu, Changhua Pei, Shanshan Lv, Tao Zhuang, and Junfeng Ge. Efficient long sequential user data modeling for click-through rate prediction. arXiv preprint arXiv:2209.12212 , 2022. [8] Xusong Chen, Dong Liu, Zheng-Jun Zha, Wengang Zhou, Zhiwei Xiong, and Yan Li. Temporal hierarchical attention at category- and item-level for micro-video click-through prediction. In MM , pages 1146-1153, 2018. [9] Yuwei Chen, Zengde Deng, Yinzhi Zhou, Zaiyi Chen, Yujie Chen, and Haoyuan Hu. An online algorithm for chance constrained resource allocation. In IEEE International Conference on Acoustics, Speech and Signal Processing (ICASSP) , pages 1-5. IEEE, 2023. [10] Heng-Tze Cheng, Levent Koc, Jeremiah Harmsen, Tal Shaked, Tushar Chandra, Hrishi Aradhye, Glen Anderson, Greg Corrado, Wei Chai, Mustafa Ispir, et al. Wide&deeplearning for recommender systems. In Proceedings of the 1st workshop on deep learning for recommender systems , pages 7-10, 2016. [11] Yufei Feng, Binbin Hu, Yu Gong, Fei Sun, Qingwen Liu, and Wenwu Ou. GRN: Generative rerank network for context-wise recommendation. arXiv preprint arXiv:2104.00860 , 2021. [12] Jyotirmoy Gope and Sanjay Kumar Jain. A survey on solving cold start problem in recommender systems. In 2017 International Conference on Computing, Communication and Automation (ICCCA) , pages 133-138. IEEE, 2017. [13] Qi Hao, Tianze Luo, and Guangda Huzhang. Re-ranking with constraints on diversified exposures for homepage recommender system. arXiv preprint arXiv:2112.07621 , 2021. [14] Xiaotian Hao, Zhaoqing Peng, Yi Ma, Guan Wang, Junqi Jin, Jianye Hao, Shan Chen, Rongquan Bai, Mingzhou Xie, Miao Xu, et al. Dynamic knapsack optimization towards efficient multi-channel sequential advertising. In International Conference on Machine Learning , pages 4060-4070, 2020. [15] Elad Hazan et al. Introduction to online convex optimization. Foundations and Trends\u00ae in Optimization , 2(3-4):157-325, 2016. [16] Jinhong Huang, Yang Li, Shan Sun, Bufeng Zhang, and Jin Huang. Personalized flight itinerary ranking at fliggy. In Proceedings of the 29th ACM International Conference on Information & Knowledge Management , pages 2541-2548, 2020. [17] Yanhua Huang, Weikun Wang, Lei Zhang, and Ruiwen Xu. Sliding spectrum decomposition for diversified recommendation. In Proceedings of the 27th ACM SIGKDD Conference on Knowledge Discovery & Data Mining , pages 3041-3049, 2021. [18] Nicole Immorlica, Karthik Abinav Sankararaman, Robert Schapire, and Aleksandrs Slivkins. Adversarial bandits with knapsacks. In 2019 IEEE 60th Annual Symposium on Foundations of Computer Science (FOCS) , pages 202-219, 2019. [19] Kalervo J\u00e4rvelin and Jaana Kek\u00e4l\u00e4inen. IR evaluation methods for retrieving highly relevant documents. In ACM SIGIR Forum , pages 243-250, 2017. [20] Yi Li, Jieming Zhu, Weiwen Liu, Liangcai Su, Guohao Cai, Qi Zhang, Ruiming Tang, Xi Xiao, and Xiuqiang He. Pear: Personalized re-ranking with contextualized transformer for recommendation. In Proceedings of the ACM Web Conference 2022 , pages 62-69, 2022. [21] Guogang Liao, Ze Wang, Xiaoxu Wu, Xiaowen Shi, Chuheng Zhang, Yongkang Wang, Xingxing Wang, and Dong Wang. Cross DQN: Cross deep Q network for ads allocation in feed. In Proceedings of the ACM Web Conference 2022 , pages 401-409, 2022. [22] Zhuoyi Lin, Sheng Zang, Rundong Wang, Zhu Sun, Chi Xu, and Chee-Keong Kwoh. Attention over self-attention: Intention-aware re-ranking with dynamic transformer encoders for recommendation. arXiv preprint arXiv:2201.05333 , 2022. [23] Zihan Lin, Hui Wang, Jingshu Mao, Wayne Xin Zhao, Cheng Wang, Peng Jiang, and Ji-Rong Wen. Feature-aware diversified re-ranking with disentangled representations for relevant recommendation. In Proceedings of the 28th ACM SIGKDD Conference on Knowledge Discovery and Data Mining , pages 3327-3335, 2022. [24] Weiwen Liu, Yunjia Xi, Jiarui Qin, Fei Sun, Bo Chen, Weinan Zhang, Rui Zhang, and Ruiming Tang. Neural re-ranking in multi-stage recommender systems: A review. In IJCAI , pages 5512-5520, 2020. [41] Tao Zhuang, Wenwu Ou, and Zhirong Wang. Globally optimized mutual influence aware ranking in e-commerce search. In IJCAI , pages 3725-3731, 2018.", "A PROOF OF REGRET BOUND": "Our proof shares the same spirit as that of Theorem 1 in [3, 25]. The difference is that [3] does not consider a lower resource limit while [25] develops proof with an additional learnable parameter within \ud835\udc53 ( \ud835\udc99 \ud835\udc61 ) and \ud835\udc54 ( \ud835\udc99 \ud835\udc61 ) . Therefore, we here develop a separate proof that is consistent with our formulation. We directly refer to a few propositions in [3, 25] as preliminaries for simplicity. It is noteworthy that developing new proof of the online revenue maximization problem is not the main focus of this paper. Recall that the integrated recommendation problem is Since \ud835\udc41 (S) denotes the sum exposures over the entire time horizon from \ud835\udc61 = 1 to \ud835\udc47 , we can replace the the upper exposure limit \ud835\udc3a max \ud835\udc5a,\ud835\udc61\u210e \ud835\udc41 (S) and lower exposure limit \ud835\udc3a min \ud835\udc5a,\ud835\udc61\u210e \ud835\udc41 (S) with \ud835\udc47\ud835\udc3a \ud835\udc5a and \ud835\udefc\ud835\udc47\ud835\udc3a \ud835\udc5a for simplicity, respectively, where \ud835\udc3a \ud835\udc5a , \ud835\udefc \u2208 [ 0 , 1 ] are constants. As such, problem P 0 can be reformulated as Before our analysis, we define constants \u00af \ud835\udc53 , \u00af \ud835\udc54 > 0, \ud835\udc3a > 0 and \u00af \ud835\udc3a > 0 such that sup \ud835\udc99 \u2208X \ud835\udc53 ( \ud835\udc99 ) \u2264 \u00af \ud835\udc53 , sup \ud835\udc99 \u2208X \ud835\udc54 ( \ud835\udc99 ) \u2264 \u00af \ud835\udc54 , \ud835\udc3a : = min \ud835\udc5a \u2208M \ud835\udc3a \ud835\udc5a and \u00af \ud835\udc3a : = max \ud835\udc5a \u2208M \ud835\udc3a \ud835\udc5a . Also, \ud835\udf03 refers to the strongly-convexity parameter of the reference function \u210e (\u00b7) . First, we bound the dual iterates as follows. Assumption A.1. There exists a constant \ud835\udc36 \u210e > 0 such that the dual iterates \ud835\udf07 \ud835\udc61 satisfy E [||\u2207 \u210e ( \ud835\udf07 \ud835\udc61 )|| \u221e ] \u2264 \ud835\udc36 \u210e , \u2200 \ud835\udc61 \u2208 [ \ud835\udc47 ] . Remark1. Note that, when choosing the reference function \u210e ( \ud835\udf06 ) : = 1 2 \u2225 \ud835\udf06 \u2225 2 , Assumption A.1 can be omited according to Proposition 3 in [25]. Denote the online Algorithm 1 as \ud835\udf0b which makes a real-time decision \ud835\udc99 \ud835\udc61 at time \ud835\udc61 . Define the stopping time \ud835\udf0f \ud835\udf0b \u2264 \ud835\udc47 as the minimum between \ud835\udc47 and the smallest time \ud835\udc61 such that there exists \ud835\udc5a \u2208 M with \u02dd \ud835\udf0f \ud835\udf0b \ud835\udc61 = 1 \ud835\udc54 \ud835\udc5a ( \ud835\udc99 \ud835\udc61 ) + \u00af \ud835\udc54 > \ud835\udc47\ud835\udc3a \ud835\udc58 . In other words, \ud835\udf0f \ud835\udf0b refers to the first time the violation of one resource constraint happens. We bound the averaged gap between \ud835\udc47 and \ud835\udf0f \ud835\udf0b as follows. Proposition 2. Suppose that Assumption A.1 holds, using a constant step-size \ud835\udf02 > 0 in Algorithm 1 yields Proof. According to Step. 9 in Algorithm 1 we have Assume that the stopping time \ud835\udf0f \ud835\udf0b is activated due to the violation of constraint on \ud835\udc58 -th channel, we have which leads to According to Proposition 6 in [25], the gradients of mirror descent satisfy \u2207 \u210e \ud835\udc58 ( \ud835\udf07 \ud835\udc61 + 1 \ud835\udc58 ) \u2265 \u2207 \u210e \ud835\udc58 ( \ud835\udf07 \ud835\udc61 \ud835\udc58 ) -\ud835\udf02 \u2207 \ud835\udf07 \ud835\udc61 \ud835\udc58,\ud835\udc61 , \u2200 \ud835\udc61 \u2264 \ud835\udf0f \ud835\udf0b , such that -\u02dd \ud835\udf0f \ud835\udf0b \ud835\udc61 = 1 \u2207 \ud835\udf07 \ud835\udc58,\ud835\udc61 \u2264 1 \ud835\udf02 GLYPH<16> \u2207 \u210e \ud835\udc58 ( \ud835\udf07 \ud835\udf0f \ud835\udf0b + 1 \ud835\udc58 ) - \u2207 \u210e \ud835\udc58 ( \ud835\udf07 1 \ud835\udc58 ) GLYPH<17> . Combing with the inequality in (30), we obtain as required. \u25a0 Let us denote the random variable \ud835\udefe \ud835\udc61 to be the type of the request at period \ud835\udc61 , which can determine the sample of the request. Proposition 3. Using a constant step-size rule \ud835\udf02 > 0 for \ud835\udc61 > 1 in Algorithm 1, it holds Proof. According to the definition of \u2207 \ud835\udf41 \ud835\udc61 and the subgradient inequality, we have (\u2207 \ud835\udf41 \ud835\udc61 ) \ud835\udc47 ( \ud835\udf41 \ud835\udc61 - \ud835\udf41 ) \u2265 \ud835\udc37 ( \ud835\udf41 \ud835\udc61 ) - \ud835\udc37 ( \ud835\udf41 ) \u00ab \u2039 where \ud835\udf11 ( \ud835\udf41 ) = \ud835\udc53 \u2217 ( \ud835\udf41 ) -\ud835\udf41 \ud835\udc47 \ud835\udc54 ( \ud835\udc99 \ud835\udc61 ) . Considering that \ud835\udc99 \ud835\udc61 is an optimal solution of \ud835\udf11 ( \ud835\udf41 \ud835\udc61 ) not of \ud835\udf11 ( \ud835\udf41 ) , we have \ud835\udc53 ( \ud835\udc99 \ud835\udc61 ) -\ud835\udf41 \ud835\udc47 \ud835\udc54 ( \ud835\udc99 \ud835\udc61 ) \u2264 \ud835\udf11 ( \ud835\udf41 ) . Then, by taking \ud835\udf41 = [ 0 , 0 , . . . , 0 ] , and summing from one to \ud835\udf0f \ud835\udf0b , we obtain where \u00af \ud835\udf41 \ud835\udf0f \ud835\udf0b = \u02dd \ud835\udf0f\ud835\udf0b \ud835\udc61 = 1 \ud835\udf41 \ud835\udc61 \ud835\udf0f \ud835\udf0b and the inequality is based on the fact that the dual function is convex. In this paper, we adopt \ud835\udf03 -strongly convex function as the relation function \u210e (\u00b7) in mirror descents. According to Step. 2 of Proposition 8 in [25], we have Combining (36) with (35), we get According to Step. 3 of Proposition 8 in [25], we have Combining (37) and (38), we complete the proof of Proposition 3. \u25a0 Before providing more details on the proof of regret bound, we introduce a new benchmark of problem P 0 as in [25] due to that problem P 0 may be infeasible due the presence of both lower and upper exposure constraints. Specifically, we define where \ud835\udf06 \u2208 [ 0 , 1 ] is the interpolation parameter. We define where S \ud835\udc47 : = S \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 S is a product distribution of length \ud835\udc47 . Now we give the definition of the new benchmark as This benchmark is an interpolate value between the expected optimal value of problem P 0 and a deterministic problem which replaces the varying utility values \ud835\udc53 ( \ud835\udc99 \ud835\udc61 ) and cost values \ud835\udc54 ( \ud835\udc99 \ud835\udc61 ) with their expected values. For this benchmark, we have where the inequality uses the fact that OPT (S) \u2264 \ud835\udc37 ( \ud835\udf41 |S) according to Proposition 1 in [25]and that OPT (S) \u2264 \ud835\udc47 \u00af \ud835\udc53 . Combining all findings together, we have where the first inequality is from (40) and the second inequality is from Proposition 2 and Proposition 3. Therefore, the constants in Theorem 1 are \ud835\udc36 1 = \u00af \ud835\udc54 \ud835\udc3a , \ud835\udc36 2 = 2 ( \u00af \ud835\udc36 2 + \u00af \ud835\udc4f 2 ) \ud835\udf03 \ud835\udf02 , and \ud835\udc36 3 = \ud835\udc49 \u210e ( \ud835\udf41 , \ud835\udf41 1 ) + \u00af \ud835\udc54 \ud835\udc3a + \ud835\udc36 \u210e +\u2225\u2207 \u210e ( \ud835\udf06 1 ) \u2225\u221e \ud835\udc3a , respectively. Moreover, recall Remark 1, we choose \u210e ( \ud835\udf06 ) : = 1 2 \u2225 \ud835\udf06 \u2225 2 and dual iterates are bounded. Hence, we complete the proof of Theorem 1. \u25a0", "B PROOF OF COST FEASIBILITY": "Proposition 1 shows that a solution obtained using Algorithm 1 can not overspend, but may underspend. Based on the definition of subgradient \u2207 \ud835\udf07 \ud835\udc61 \ud835\udc58 , we have Now, given that \u2736 ( \ud835\udf07 \u2265 0 ) + \ud835\udefc \ud835\udc58 \u2736 ( \ud835\udf07 < 0 ) \u2265 \ud835\udefc \ud835\udc58 for any \ud835\udf07 \u2208 R and that \ud835\udf0f \ud835\udf0b \u2264 \ud835\udc47 by definition, we have where the second inequality comes from Proposition 2."}
